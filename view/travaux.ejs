<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>travaux</title>
    <link rel="stylesheet" href="css/travaux.css">
    <link rel="stylesheet" href="css/class.css">
</head>
<body>
    
    <div id="container">
       
        <%- include('../public/composants/page_head.ejs') %>

        <div class="page_body">

            <%- include('../public/composants/header.ejs') %> 
          
            <h2 id="culture_titre">Champs de <%= culture %> de <%= lieu %></h2>

            <% let travaux_1 = []; %> 
            <% let travaux_2 = []; %>
            <% let travaux_3 = []; %>
            <% let travaux_4 = []; %>
          
            <% let totaux_1 = 0; %>  <% let totaux_5 = 0; %>  <% let totaux_9 = 0; %>   <% let totaux_13 = 0; %>
            <% let totaux_2 = 0; %>  <% let totaux_6 = 0; %>  <% let totaux_10 = 0; %>  <% let totaux_14 = 0; %>
            <% let totaux_3 = 0; %>  <% let totaux_7 = 0; %>  <% let totaux_11 = 0; %>  <% let totaux_15 = 0; %>
            <% let totaux_4 = 0; %>  <% let totaux_8 = 0; %>  <% let totaux_12 = 0; %>  <% let totaux_16 = 0; %>
          
        
            <% for(let i=0; i<data.length; i++) {
                if(data[i].id_etape === 1) { 
                    travaux_1.push(data[i]);

                    totaux_1 += parseInt(data[i].personnel);
                    totaux_2 += parseInt(data[i].quantite.split(' ')[0]);
                    totaux_3 += parseInt(data[i].duree.split(' ')[0]);
                    totaux_4 += parseInt(data[i].cout.split(' ')[0]);
                }
                if(data[i].id_etape === 2) { 
                    travaux_2.push(data[i]); 

                    totaux_5 += parseInt(data[i].personnel);
                    totaux_6 += parseInt(data[i].quantite.split(' ')[0]);
                    totaux_7 += parseInt(data[i].duree.split(' ')[0]);
                    totaux_8 += parseInt(data[i].cout.split(' ')[0]);
                }
                if(data[i].id_etape === 3) { 
                    travaux_3.push(data[i]); 

                    totaux_9 += parseInt(data[i].personnel);
                    totaux_10 += parseInt(data[i].quantite.split(' ')[0]);
                    totaux_11 += parseInt(data[i].duree.split(' ')[0]);
                    totaux_12 += parseInt(data[i].cout.split(' ')[0]);
                }
                if(data[i].id_etape === 4) { 
                    travaux_4.push(data[i]); 

                    totaux_13 += parseInt(data[i].personnel);
                    totaux_14 += parseInt(data[i].quantite.split(' ')[0]);
                    totaux_15 += parseInt(data[i].duree.split(' ')[0]);
                    totaux_16 += parseInt(data[i].cout.split(' ')[0]);
                }
            } %>
          
          <!-- --------------------------------------------------------------------------------------------------------------------------------------- -->

            <h3 class="culture_sous_titre" id="culture_info_titre">Champs No_<%= id_champs %></h3>

            <%- include('../public/composants/onglet.ejs') %> 

            <h1 id="travaux_titre">Travaux effectues</h1>
            <div class="plus" id="travaux_plus">+</div>

            <center>
                <div class="culture_fiches" id="culture_fiche_des_travaux">

                    <p id="lieu"      style="display: none;"><%= lieu %></p>
                    <p id="culture"   style="display: none;"><%= culture %></p>
                    <p id="id_champs" style="display: none;"><%= id_champs %></p>
                    
                    <table class="table_des_travaux">
                        <tr id='tr_1'>
                            <th style="display:none"></th>
                            <th class="th_head" style="max-width: 6rem;">Date</th>
                            <th class="th_head" style="max-width: 16rem;"> Travail</th>
                            <th class="th_head" style="max-width: 6rem;"> Moyen</th>
                            <th class="th_head" style="max-width: 4rem;">Quantite</th>
                            <th class="th_head" style="max-width: 4rem;">Personnel</th>
                            <th class="th_head" style="max-width: 4rem;">Duree</th>
                            <th class="th_head" style="max-width: 6rem;">Cout</th>
                        </tr>

                        <tr class="tr_vide"><td></td></tr>

                        <tr><th class="etape_libele" colspan="7">Preparation du terrain</th></tr>

                        <tr class="tr_vide"><td></td></tr>

                        <% for(let i=0; i<travaux_1.length; i++) { %>
                            <tr id='tr_1<%= i %>'>
                                <td style="display:none"><%= travaux_1[i].id %></td>
                                <td><%= travaux_1[i].date %></td>
                                <td><%= travaux_1[i].travail %></td>
                                <td><%= travaux_1[i].moyen %></td>
                                <td style="text-align: right;"><%= travaux_1[i].quantite %></td>
                                <td style="text-align: right;"><%= travaux_1[i].personnel %></td>
                                <td style="text-align: right;"><%= travaux_1[i].duree %></td>
                                <td style="text-align: right;"><%= travaux_1[i].cout %></td>
                                <td class="td_vide"></td>
                                <td class="td_options modifier_travail">Modifier</td>
                                <td class="td_options supprimer_travail">Supprimer</td>
                            </tr>
                        <% } %>
                        
                        <tr class="tr_vide"><td></td></tr>

                        <tr>
                            <th colspan="4"></th>
                            <th class="th_foot" ><%= totaux_1; %></th>
                            <th class="th_foot" ><%= totaux_3; %></th>
                            <th class="th_foot" id="totaux_1"><%= totaux_4; %></th>
                        </tr>

                        <tr class="tr_vide"><td></td></tr>

                        <tr><th class="etape_libele" colspan="7">Semis</th></tr>
                        
                        <tr class="tr_vide"><td></td></tr>

                        <% for(let i=0; i<travaux_2.length; i++) { %>
                            <tr id='tr_2<%= i %>'>
                                <td style="display:none"><%= travaux_2[i].id %></td>
                                <td><%= travaux_2[i].date %></td>
                                <td><%= travaux_2[i].travail %></td>
                                <td><%= travaux_2[i].moyen %></td>
                                <td style="text-align: right;"><%= travaux_2[i].quantite %></td>
                                <td style="text-align: right;"><%= travaux_2[i].personnel %></td>
                                <td style="text-align: right;"><%= travaux_2[i].duree %></td>
                                <td style="text-align: right;"><%= travaux_2[i].cout %></td>
                                <td class="td_vide"></td>
                                <td class="td_options modifier_travail">Modifier</td>
                                <td class="td_options supprimer_travail">Supprimer</td>
                            </tr>
                        <% } %>
                        
                        <tr class="tr_vide"><td></td></tr>

                        <tr>
                            <th colspan="4"></th>
                            <th class="th_foot" ><%= totaux_5; %></th>
                            <th class="th_foot" ><%= totaux_7; %></th>
                            <th class="th_foot"id="totaux_2" ><%= totaux_8; %></th>
                        </tr>
                        
                        <tr class="tr_vide"><td></td></tr>

                        <tr><th class="etape_libele" colspan="7">Travaux d'Entretient</th></tr>
                        
                        <tr class="tr_vide"><td></td></tr>

                        <% for(let i=0; i<travaux_3.length; i++) { %>
                            <tr id='tr_3<%= i %>'>
                                <td style="display:none"><%= travaux_3[i].id %></td>
                                <td><%= travaux_3[i].date %></td>
                                <td><%= travaux_3[i].travail %></td>
                                <td><%= travaux_3[i].moyen %></td>
                                <td style="text-align: right;"><%= travaux_3[i].quantite %></td>
                                <td style="text-align: right;"><%= travaux_3[i].personnel %></td>
                                <td style="text-align: right;"><%= travaux_3[i].duree %></td>
                                <td style="text-align: right;"><%= travaux_3[i].cout %></td>
                                <td class="td_vide"></td>
                                <td class="td_options modifier_travail">Modifier</td>
                                <td class="td_options supprimer_travail">Supprimer</td>
                            </tr>
                        <% } %>
                        
                        <tr class="tr_vide"><td></td></tr>

                        <tr>
                            <th colspan="4"></th>
                            <th class="th_foot" ><%= totaux_9; %></th>
                            <th class="th_foot" ><%= totaux_11; %></th>
                            <th class="th_foot" id="totaux_3"><%= totaux_12; %></th>
                        </tr>
                        
                        <tr class="tr_vide"><td></td></tr>

                        <tr><th class="etape_libele" colspan="7">Recolte</th></tr>
                        
                        <tr class="tr_vide"><td></td></tr>

                        <% for(let i=0; i<travaux_4.length; i++) { %>
                            <tr id='tr_4<%= i %>'>
                                <td style="display:none"><%= travaux_4[i].id %></td>
                                <td><%= travaux_4[i].date %></td>
                                <td><%= travaux_4[i].travail %></td>
                                <td><%= travaux_4[i].moyen %></td>
                                <td style="text-align: right;"><%= travaux_4[i].quantite %></td>
                                <td style="text-align: right;"><%= travaux_4[i].personnel %></td>
                                <td style="text-align: right;"><%= travaux_4[i].duree %></td>
                                <td style="text-align: right;"><%= travaux_4[i].cout %></td>
                                <td class="td_vide"></td>
                                <td class="td_options modifier_travail">Modifier</td>
                                <td class="td_options supprimer_travail">Supprimer</td>
                            </tr>
                        <% } %>
                        
                        <tr class="tr_vide"><td></td></tr>

                        <tr>
                            <th colspan="4"></th>
                            <th class="th_foot" ><%= totaux_13; %></th>
                            <th class="th_foot" ><%= totaux_15; %></th>
                            <th class="th_foot" id="totaux_4"><%= totaux_16; %></th>
                        </tr>

                    </table>
                
                </div>
            </center>

            <div class="couvercle" id="couvercle_de_fiche">
                <div class="fiche_des_travaux_journaliers">
                    <%- include('../public/composants/fiche.ejs') %> 
                </div>
            </div>

            <div class="cover" id="couvercle_edition_travail">
                <%- include('../public/composants/edition_travaux.ejs') %> 
            </div>

        
        </div>

        <script src="js/travaux.js"></script>

    </div>
</body>
</html>